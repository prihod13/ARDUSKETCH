#include <Stepper.h>

int irsensor= 2;                    // Вывод OUT на модуле подключен к выходу 7 Arduino
int sensorvalue;    

// средние два пина меняем местами!
#define DRV_PIN_1 8
#define DRV_PIN_2 10
#define DRV_PIN_3 9
#define DRV_PIN_4 11

void _write4(bool p0, bool p1, bool p2, bool p3) {
    digitalWrite(DRV_PIN_1, p0);
    digitalWrite(DRV_PIN_2, p1);
    digitalWrite(DRV_PIN_3, p2);
    digitalWrite(DRV_PIN_4, p3);
}

// сделать шаг в направлении (0 или 1)
void step(bool dir) {
    static uint8_t curstep;
    dir ? ++curstep : --curstep;

    switch (curstep & 0b11) {
        case 0: _write4(1, 0, 1, 0); break;
        case 1: _write4(0, 1, 1, 0); break;
        case 2: _write4(0, 1, 0, 1); break;
        case 3: _write4(1, 0, 0, 1); break;
    }
    
}

void setup() {
    pinMode(DRV_PIN_1, OUTPUT);
    pinMode(DRV_PIN_2, OUTPUT);
    pinMode(DRV_PIN_3, OUTPUT);
    pinMode(DRV_PIN_4, OUTPUT);
    Serial.begin(9600);                // Задаем скорость передачи данных
    pinMode(irsensor,INPUT); 
}

void loop() {
    sensorvalue=digitalRead(irsensor); // Считываем показания в переменной sensorvalue.
    Serial.print("Sensor == ");         // Выводим текст
    Serial.println(sensorvalue); 
    if (sensorvalue == 0)
    {
       int steps = 810; // 780 шагов в одну сторону
    while (steps--) {
        step(1);//параметер регулирует направления отсчвета и соответсвено направление открытия тоесть вращения
        delay(5);

    }
    delay(5000); 

    //задержка перед открытием
       steps = 810; // 780 шагов в обратную
    while (steps--) {
        step(0);
        delay(5);
    }

    } 
    else 
    {
      delay(1000);
    }
    
   
}
